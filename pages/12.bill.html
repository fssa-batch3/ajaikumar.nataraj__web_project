<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bill</title>
    <link rel="stylesheet" href="../assets/CSS/9a-bill.css" />
  </head>
  <body>
    <header>
      <img src="../assets/image/logo (2).png" alt="logo" width="130px" />
      <h4>Your Product's Bill</h4>
      <img
        src="../assets/image/profile.png"
        alt="profile"
        width="110px"
        onclick="profile()"
      />
    </header>
    <button onclick="account()">Account Detail</button>
    <table>
      <script>
        let Card = JSON.parse(localStorage.getItem("newly_added"));
        let total = 0;
        let table_card = document.createElement("table");

        let th_tr1 = document.createElement("tr");
        table_card.append(th_tr1);

        let th1_tr = document.createElement("th");
        th1_tr.innerText = "Products Name";
        th_tr1.append(th1_tr);

        let th2_tr = document.createElement("th");
        th2_tr.innerText = "Quantity";
        th_tr1.append(th2_tr);

        let th4_tr = document.createElement("th");
        th4_tr.innerText = "Price";
        th_tr1.append(th4_tr);

        let th3_tr = document.createElement("th");
        th3_tr.innerText = "Total Amount";
        th_tr1.append(th3_tr);

        for (let i = 0; i < Card.length; i++) {
          let td_tr2 = document.createElement("tr");
          table_card.append(td_tr2);

          let td1_tr = document.createElement("td");
          td1_tr.innerText = Card[i]["Name"];
          td_tr2.append(td1_tr);
          console.log(Card);

          let td2_tr = document.createElement("td");
          td2_tr.innerText = Card[i]["Qty"] + " kg";
          td_tr2.append(td2_tr);

          let td4_tr = document.createElement("td");
          td4_tr.innerText = "Rs." + Card[i]["Price"];
          td_tr2.append(td4_tr);

          let td3_tr = document.createElement("td");
          td3_tr.innerText = "Rs. " + Card[i]["Price"] * Card[i]["Qty"];
          td_tr2.append(td3_tr);

          total += parseInt(Card[i]["Price"]) * parseInt(Card[i]["Qty"]);

          document.querySelector("table").append(table_card);
        }
      </script>
      <div id="form" class="details">
        <h3>Your Pickup details:</h3>
        <form class="detail">
          <input type="text" id="First_name" placeholder="name" />
          <input
            type="number"
            id="Phone_Number"
            placeholder="Phone number"
            maxlength="10"
          />
          <input type="text" id="Land_Address" placeholder="address" required />
          <!-- <input type="date" id="Pickup_date" placeholder="Pickup date" /> -->
        </form>
        <button type="submit">Save</button>
      </div>
    </table>

    <div class="amount_total">
      <table>
        <tr>
          <td>Total Amount</td>
          <td></td>
          <td id="operoation"></td>
        </tr>
      </table>
    </div>
    <footer>
      <img
        src="../assets/image/smiling-face.gif"
        alt="smiling-face"
        width="50px"
      />
      Thanks for Selling
      <img src="../assets/image/sparkling-heart.gif" alt="heart" width="50px" />
      We always Welcomes you!
    </footer>
    <script>
      let total_value = document.getElementById("operoation");
      total_value.append("â‚¹" + total);
      const oneUser = JSON.parse(localStorage.getItem("logIn"));

      const user_info = JSON.parse(localStorage.getItem("user_info"));
      let select_user = user_info.find(function (event) {
        let customerEmail = event["Email"];
        if (user_info == customerEmail) {
          return true;
        } else if (oneUser == customerEmail) {
          return true;
        }
      });

      console.log(select_user);
      // to get value from registration form
      const phNo = document.getElementById("Phone_Number");
      const userName = document.getElementById("First_name");
      // const transport_DOB = document.getElementById("Pickup_date");
      const Land_Address = document.getElementById("Land_Address");

      // Compare the values

      phNo.value = select_user["Phone_number"];
      userName.value = select_user["FullName"];
      // transport_DOB.value = select_user["transport_DOB"];
      Land_Address.value = select_user["Land_Address"] || "";

      // to replace the values
      const form = document.getElementById("form");
      form.addEventListener("change", function (event) {
        event.preventDefault();

        let FullName = document.getElementById("First_name").value;
        let Phone_number = document.getElementById("Phone_Number").value;
        // let transport_DOB = document.getElementById("Pickup_date").value;
        let Land_Address = document.getElementById("Land_Address").value;

        let newData = {
          FullName,
          Phone_number,
          // transport_DOB,
          Land_Address,
        };
        console.log(newData);

        // assign the value to

        const combineData = Object.assign(select_user, newData);
        console.log(combineData);
        // alert("successfully changed");

        let findIndex = user_info.indexOf(select_user);
        user_info[findIndex] = combineData;
        localStorage.setItem("user_info", JSON.stringify(user_info));
      });

      function account() {
        window.location.href = "/pages/13.Acct.detail.html";
      }
      function profile() {
        window.location.href = "/pages/profile.html";
      }
    </script>
  </body>
</html>
