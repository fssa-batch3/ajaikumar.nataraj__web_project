<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../assets/CSS/history.css" />
  </head>
  <body>
    <header>
      <nav>
        <img
          src="../assets/image/arrowback.png"
          alt="arrow"
          onclick="back()"
          style="
            border-radius: 50px;
            padding: 10px 10px 10px 10px;
            background-color: #2bae66ff;
          "
        />
      </nav>
      <nav>
        <img
          src="../assets/image/RISHIMARKET (1).png"
          alt="logo"
          width="100px"
        />
      </nav>
      <!-- <nav><h2>Your history</h2></nav> -->
      <nav>
        <img src="../assets/image/profile.png" alt="profile" width="80px" />
      </nav>
    </header>
    <button type="change" id="change" onclick="order()">Payment Page</button>

    <div class="details">
      <h1>Enter your delivery details:</h1>
      <form class="detail" id="form">
        <input type="text" id="First_name" placeholder="Name" />
        <input
          type="tel"
          id="Phone_Number"
          maxlength="10"
          placeholder="Phone number"
        />
        <input type="text" id="Land_Address" placeholder="Address" />
        <!-- <input type="date" id="Pickup_date" placeholder="Pickup date" /> -->
      </form>
    </div>
    <main class="card_main">
      <!-- <section class="card_div">
        <input type="image" />
        <input type="text" />
        <input type="number" />
        <input type="number" />
      </section> -->
    </main>

    <script>
      // JSON
      let Card = JSON.parse(localStorage.getItem("added_list"));
      let total = 0;

      console.log(Card);

      const detail = JSON.parse(localStorage.getItem("added_list"));

      // Card creating by using JavaScript
      for (let i = 0; i < Card.length; i++) {
        let findDetail = detail.find(function (event) {
          let id = event["Product_id"];
          if (Card[i]["Product_id"] == id) {
            return true;
          }
        });
        // console.log(Card[i]["Url"]);
        let div_card = document.createElement("div");
        div_card.setAttribute("class", "card_div");
        div_card.setAttribute("type", "button");
        div_card.setAttribute("id", "div");
        // div_card.setAttribute("id", Card[i]["id"]);
        // div_card.setAttribute("onclick", "card(this.id)");

        let fruit_name = document.createElement("input");
        fruit_name.setAttribute("value", Card[i]["Name"]);
        fruit_name.setAttribute("id", "pName");
        div_card.append(fruit_name);

        let rupees = document.createElement("input");
        rupees.setAttribute("value", "Rs." + Card[i]["Price"] + " /kg");
        rupees.setAttribute("id", "pPrice");
        rupees.setAttribute("type", "text");
        div_card.append(rupees);

        let input_value = document.createElement("input");
        input_value.setAttribute("value", Card[i]["bQty"] + " kg");
        // input_value.setAttribute("type", "number");
        input_value.setAttribute("width", "10px");
        input_value.setAttribute("id", "pQty");
        div_card.append(input_value);

        let image = document.createElement("input");
        // console.log(Card[i]);
        image.setAttribute("value", "Rs." + Card[i]["Price"] * Card[i]["bQty"]);
        image.setAttribute("alt", "image");
        image.setAttribute("id", "pUrl");
        div_card.append(image);

        let edit = document.createElement("button");
        edit.innerText = "Cancel";

        edit.setAttribute("id", "submit");
        edit.setAttribute("type", "submit");
        div_card.append(edit);

        edit.addEventListener("click", function (event) {
          event.preventDefault();
          let addData = JSON.parse(localStorage.getItem("added_list"));
          let findIndex = detail.indexOf(findDetail);
          let msg = confirm(
            "Are you sure you want to remove this product from your cart"
          );
          if (msg !== true) {
            return;
          } else {
            detail.splice(findIndex, 1);
            localStorage.setItem("added_list", JSON.stringify(detail));
          }
        });

        total += parseInt(Card[i]["Price"]) * parseInt(Card[i]["bQty"]);

        document.querySelector(".card_main").append(div_card);
      }
    </script>

    <div class="amount_total">
      <table>
        <tr>
          <td>Total Amount</td>
          <td></td>
          <td id="operoation"></td>
        </tr>
      </table>
    </div>

    <script>
      let total_value = document.getElementById("operoation");
      total_value.append("â‚¹" + total);

      const oneUser = JSON.parse(localStorage.getItem("logIn"));

      const user_info = JSON.parse(localStorage.getItem("user_info"));
      let select_user = user_info.find(function (event) {
        let customerEmail = event["Email"];
        if (user_info == customerEmail) {
          return true;
        } else if (oneUser == customerEmail) {
          return true;
        }
      });

      console.log(select_user);
      // to get value from registration form
      const phNo = document.getElementById("Phone_Number");
      const userName = document.getElementById("First_name");
      // const transport_DOB = document.getElementById("Pickup_date");
      const Land_Address = document.getElementById("Land_Address");

      // Compare the values

      phNo.value = select_user["Phone_number"];
      userName.value = select_user["FullName"];
      // transport_DOB.value = select_user["transport_DOB"];
      Land_Address.value = select_user["Land_Address"];

      // to replace the values
      const form = document.getElementById("form");
      form.addEventListener("change", function (event) {
        event.preventDefault();

        let FullName = document.getElementById("First_name").value;
        let Phone_number = document.getElementById("Phone_Number").value;
        // let transport_DOB = document.getElementById("Pickup_date").value;
        let Land_Address = document.getElementById("Land_Address").value;

        let newData = {
          FullName,
          Phone_number,
          // transport_DOB,
          Land_Address,
        };
        console.log(newData);

        // assign the value to

        const combineData = Object.assign(select_user, newData);
        console.log(combineData);
        // alert("successfully changed");

        let findIndex = user_info.indexOf(select_user);
        user_info[findIndex] = combineData;
        localStorage.setItem("user_info", JSON.stringify(user_info));
      });

      function order() {
        window.location.href = "/pages/8.payment-page.html";
      }

      function back() {
        window.location.href = "/pages/6.buy-2.html";
      }
    </script>
  </body>
</html>
