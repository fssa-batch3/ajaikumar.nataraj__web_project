<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../assets/CSS/history.css" />
  </head>
  <body>
    <header>
      <nav>
        <img
          src="../assets/image/arrowback.png"
          alt="arrow"
          onclick="back()"
          style="
            border-radius: 50px;
            padding: 10px 10px 10px 10px;
            background-color: #2bae66ff;
          "
        />
      </nav>
      <nav>
        <img
          src="../assets/image/RISHIMARKET (1).png"
          alt="logo"
          width="100px"
        />
      </nav>
      <nav><h2>Fruits Shop</h2></nav>
      <nav>
        <img src="../assets/image/profile.png" alt="profile" width="80px" />
      </nav>
    </header>
    <div class="nav">
      <nav>
        <input type="search" id="searchbar" placeholder="Search..." />
        <!-- <button id="search-button">Search</button> -->
        <!-- <ul id="search-results"></ul> -->
      </nav>
      <button onclick="cart()">Go to Cart</button>
    </div>

    <section class="button"></section>

    <main id="form" class="card_main"></main>

    <script>
      let Card = JSON.parse(localStorage.getItem("newUploadList"));
      let searchbar = document.getElementById("searchbar");
      let cards = document.getElementsByClassName("card_div");

      searchbar.addEventListener("input", () => {
        for (let i = 0; i < cards.length; i++) {
          const element = cards[i];
          if (
            element.innerHTML
              .toLowerCase()
              .includes(searchbar.value.toLowerCase())
          ) {
            element.style.display = "block";
          } else {
            element.style.display = "none";
          }
        }
      });

      // for types bar........

      let bar = document.createElement("nav");

      let fruit = document.createElement("button");
      fruit.innerText = "Fruits";
      fruit.setAttribute("class", "same");
      fruit.setAttribute("onclick", "fruits()");
      bar.append(fruit);

      let vegetable = document.createElement("button");
      vegetable.innerText = "Vegetables";
      vegetable.setAttribute("onclick", "vegetables()");
      bar.append(vegetable);

      let grains = document.createElement("button");
      grains.innerText = "Cereals & Grains";
      grains.setAttribute("onclick", "pulses()");
      bar.append(grains);

      let tea = document.createElement("button");
      tea.innerText = "Tea & Coffee";
      tea.setAttribute("onclick", "coffee()");
      bar.append(tea);

      document.querySelector(".button").append(bar);

      // JSON

      const detail = JSON.parse(localStorage.getItem("newUploadList"));

      // Data creating by using JavaScript
      for (let i = 0; i < Card.length; i++) {
        let Data = Card[i]["newUploadProducts"];
        console.log(Data);

        for (let j = 0; j < Data.length; j++) {
          console.log(j);
          if (Data[j]["Type"] == "Fruit") {
            let div_card = document.createElement("div");
            div_card.setAttribute("class", "card_div");
            div_card.setAttribute("type", "button");
            div_card.setAttribute("id", "form");

            let image = document.createElement("img");
            image.setAttribute("src", Data[j]["Url"]);
            image.setAttribute("alt", "image");
            image.setAttribute("id", "pUrl");
            div_card.append(image);

            let fruit_name = document.createElement("input");
            fruit_name.setAttribute("value", Data[j]["Name"]);
            fruit_name.setAttribute("id", "pName");
            div_card.append(fruit_name);

            let rupees = document.createElement("input");
            rupees.setAttribute("value", Data[j]["Price"] + " /kg");
            rupees.setAttribute("id", "pPrice");
            rupees.setAttribute("type", "text");
            div_card.append(rupees);

            let button = document.createElement("button");
            button.innerText = "Add Cart";
            button.setAttribute("id", "submit");
            button.setAttribute("value", "submit");
            button.setAttribute("id", Data[j]["ProductId"]);
            button.setAttribute("onclick", "addProduct(this.id)");
            div_card.append(button);

            function addProduct(ProductId) {
              event.preventDefault();
              console.log(ProductId);

              let addData = JSON.parse(localStorage.getItem("added_list"));
              console.log(addData);

              console.log(Card);

              let currentProduct;

              for (let i = 0; i < Card.length; i++) {
                for (let j = 0; j < Card[i]["newUploadProducts"].length; j++) {
                  if (
                    Card[i]["newUploadProducts"][j]["ProductId"] == ProductId
                  ) {
                    currentProduct = Card[i]["newUploadProducts"][j];
                  }
                }
              }

              console.log(currentProduct);

              //  old code for push bQty
              let arr = [];
              console.log(arr);
              currentProduct["bQty"] = "1";
              arr.push(currentProduct["bQty"]);

              let msg = confirm(
                "Are you sure you want to add this product to your cart"
              );
              if (msg !== true) {
                return;
              } else {
                if (addData === null) {
                  let array = [];
                  array.push(currentProduct);
                  localStorage.setItem("added_list", JSON.stringify(array));
                } else {
                  addData.push(currentProduct);
                  localStorage.setItem("added_list", JSON.stringify(addData));
                }
              }
            }

            let info = document.createElement("a");
            info.innerText = "more info -->";
            info.setAttribute("href", "./detail.html?Name=" + Data[j]["Name"]);
            div_card.append(info);

            document.querySelector(".card_main").append(div_card);
          }
        }
      }

      function cart() {
        window.location.href = "/pages/6.buy-2.html";
      }

      function back() {
        window.location.href = "/pages/4.index.html";
      }
      function vegetables() {
        window.location.href = "/pages/5b-vegetables.html";
      }
      function coffee() {
        window.location.href = "/pages/5c-tea.html";
      }
      function pulses() {
        window.location.href = "/pages/5d-grain.html";
      }
    </script>
  </body>
</html>
