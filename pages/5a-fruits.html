<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../assets/CSS/history.css" />
  </head>
  <body>
    <header>
      <nav>
        <img
          src="../assets/image/arrowback.png"
          alt="arrow"
          onclick="back()"
          style="
            border-radius: 50px;
            padding: 10px 10px 10px 10px;
            background-color: #2bae66ff;
          "
        />
      </nav>
      <nav>
        <img
          src="../assets/image/RISHIMARKET (1).png"
          alt="logo"
          width="100px"
        />
      </nav>
      <!-- <nav><h2>Your history</h2></nav> -->
      <nav>
        <img src="../assets/image/profile.png" alt="profile" width="80px" />
      </nav>
    </header>
    <div class="nav">
      <!-- <nav>
         <img
          src="../assets/image/search.png"
          alt="search_bar"
          height="35px"
          style="margin-top: 20px"
        />
        <input type="text" placeholder="search hear" /> 
        <input type="text" id="search-input" placeholder="Search..." />
        <button id="search-button">Search</button>
        <ul id="search-results"></ul>
      </nav> -->
      <button onclick="cart()">Go to Cart</button>
    </div>

    <section class="button"></section>

    <main id="form" class="card_main">
      <!-- <section class="card_div">
        <input type="image" />
        <input type="text" />
        <input type="number" />
        <input type="number" />
      </section> -->
    </main>

    <script>
      // for search bar.........
      let nav = document.createElement("nav");

      let input = document.createElement("input");
      input.setAttribute("type", "text");
      input.setAttribute("id", "search-input");
      input.setAttribute("placeholder", "Search here...");
      nav.append(input);

      let btn = document.createElement("button");
      btn.setAttribute("id", "search-input");
      btn.innerText = "search";
      nav.append(btn);

      let list = document.createElement("ul");
      list.setAttribute("id", "search-results");
      nav.append(list);

      document.querySelector(".nav").append(nav);

      // for types bar........

      let bar = document.createElement("nav");

      let fruit = document.createElement("button");
      fruit.innerText = "Fruits";
      fruit.setAttribute("onclick", "fruit()");
      bar.append(fruit);

      let vegetable = document.createElement("button");
      vegetable.innerText = "Vegetables";
      vegetable.setAttribute("onclick", "vegetable()");
      bar.append(vegetable);

      let grains = document.createElement("button");
      grains.innerText = "Cereals & Grains";
      grains.setAttribute("onclick", "grains()");
      bar.append(grains);

      let tea = document.createElement("button");
      tea.innerText = "Tea & Coffee";
      tea.setAttribute("onclick", "tea()");
      bar.append(tea);

      document.querySelector(".button").append(bar);

      // JSON
      let Card = JSON.parse(localStorage.getItem("product_details"));

      const detail = JSON.parse(localStorage.getItem("product_details"));

      // Card creating by using JavaScript
      for (let i = 0; i <= Card.length; i++) {
        // let findDetail = Card.find(function (event) {
        //   let id = event["ProductId"];
        //   if (detail[i]["ProductId"] == id) {
        //     return true;
        //   }
        // });

        let div_card = document.createElement("div");
        div_card.setAttribute("class", "card_div");
        div_card.setAttribute("type", "button");
        div_card.setAttribute("id", "form");
        // div_card.setAttribute("id", Card[i]["id"]);
        // div_card.setAttribute("onclick", "card(this.id)");

        let image = document.createElement("img");
        // console.log(Card[i]);
        image.setAttribute("src", Card[i]["Url"]);
        image.setAttribute("alt", "image");
        image.setAttribute("id", "pUrl");
        div_card.append(image);

        let fruit_name = document.createElement("input");
        fruit_name.setAttribute("value", Card[i]["Name"]);
        fruit_name.setAttribute("id", "pName");
        div_card.append(fruit_name);

        let rupees = document.createElement("input");
        rupees.setAttribute("value", Card[i]["Price"] + " /kg");
        rupees.setAttribute("id", "pPrice");
        rupees.setAttribute("type", "text");
        rupees.setAttribute("name", "num1");
        div_card.append(rupees);

        // let input_value = document.createElement("input");
        // input_value.setAttribute("value", Card[i]["Qty"]);
        // input_value.setAttribute("type", "number");
        // input_value.setAttribute("placeholder", "       kg");
        // input_value.setAttribute("width", "10px");
        // // input_value.setAttribute("pattern", "[0-9]{10}");
        // input_value.setAttribute("id", "Qty");
        // // input_value.setAttribute("name", "num2");
        // div_card.append(input_value);

        let button = document.createElement("button");
        button.innerText = "Add Cart";
        button.setAttribute("id", "submit");
        button.setAttribute("value", "submit");
        button.setAttribute("onclick", `addProdect(${Card[i]["ProductId"]})`);
        // button.setAttribute("onclick", multiply());
        div_card.append(button);

        function addProdect(product_id) {
          event.preventDefault();

          let addData = JSON.parse(localStorage.getItem("added_list"));
          console.log(detail);
          console.log(product_id);
          let findedObject = detail.find((F) => F.ProductId == product_id);
          console.log(findedObject);
          let findIndex = detail.indexOf(findedObject);
          console.log(findIndex);

          //  old code for push bQty
          let arr = [];
          Card[findIndex]["bQty"] = "1";
          arr.push(Card[findIndex]);

          let msg = confirm(
            "Are you sure you want to add this product to your cart"
          );
          if (msg !== true) {
            return;
          } else {
            if (addData === null) {
              let array = [];
              array.push(Card[findIndex]);
              localStorage.setItem("added_list", JSON.stringify(array));
            } else {
              addData.push(Card[findIndex]);
              localStorage.setItem("added_list", JSON.stringify(addData));
            }
          }
        }

        let info = document.createElement("a");
        info.innerText = "more info -->";
        info.setAttribute("href", "./detail.html?Name=" + Card[i]["Name"]);
        div_card.append(info);

        document.querySelector(".card_main").append(div_card);
      }

      const items = Card[i][Name];

      const searchInput = document.getElementById("search-input");
      const searchButton = document.getElementById("search-button");
      const searchResults = document.getElementById("search-results");

      searchButton.addEventListener("click", () => {
        const searchTerm = searchInput.value;
        const filteredItems = items.filter((Name) => item.includes(searchTerm));

        searchResults.innerHTML = "";
        filteredItems.forEach((Name) => {
          const li = document.createElement("li");
          li.innerText = Name;
          searchResults.appendChild(li);
        });
      });

      function cart() {
        window.location.href = "/pages/6.buy-2.html";
      }

      function back() {
        window.location.href = "/pages/4.index.html";
      }
    </script>
  </body>
</html>
