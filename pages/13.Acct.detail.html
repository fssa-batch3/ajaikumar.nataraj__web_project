<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../assets/CSS/13-acct-detail.css" />
    <title>payment-page</title>
  </head>
  <body>
    <header>
      <nav>
        <img
          src="../assets/image/arrowback.png"
          alt="arrow"
          width="50px"
          onclick="back()"
        />
      </nav>
      <nav>
        <img
          src="../assets/image/RISHIMARKET (1).png"
          alt="logo"
          width="100px"
        />
      </nav>
      <nav><h2>Payment Details</h2></nav>
      <nav>
        <img
          src="../assets/image/profile.png"
          alt="profile"
          width="80px"
          onclick="profile()"
        />
      </nav>
    </header>

    <!-- <section class="side-bar">
      <nav>
        <a href="#card">Cards</a>
      </nav>
      <nav>
        <a href="#account">Account Details</a>
      </nav>
      <nav>
        <a href="#qr_code">QR Code</a>
      </nav>
    </section> -->

    <!-- <main>
      <div id="card" class="topic">
        <h2>Choose Your Best Payment Method</h2>
      </div>
    </main> -->
    <div id="account"></div>
    <h2 class="topic">Fill Account Details here</h2>
    <main class="detail_main">
      <form id="form" class="section-detail">
        <label for="card_no">Enter Your Card No</label> <br />
        <input
          type="number"
          id="Bank_Card_no"
          pattern="[0-9]{16}"
          autocomplete="off"
          required
        />
        <br />
        <label for="card_name">Enter Your Card Holder Name</label> <br />
        <input
          type="text"
          id="holder_name"
          pattern="[a-zA-Z]{1,20}"
          autocomplete="off"
          required
        /><br />
        <label for="card_ifsc_no">Enter Your IFSC Code</label> <br />
        <input
          type="text"
          id="ifsc_code"
          pattern="{0-9}[A-Z]"
          autocomplete="off"
          required
        /><br />
        <label for="card_cvv_no">Enter Your CVV No</label> <br />
        <input
          type="number"
          pattern="[0-9]"
          autocomplete="off"
          maxlength="3"
          id="cvv_no"
          required
        /><br />
        <label for="card_ex_date">Enter Your Expiry Date</label> <br />
        <input
          type="date"
          id="card_exp_date"
          pattern="[a-zA-Z]{1,20}"
          autocomplete="off"
          required
        /><br />
        <!-- <div class="btn"> -->
        <button type="submit">Save</button>
        <button onclick="bill()">Go to Bill</button>
        <!-- </div> -->
      </form>
    </main>

    <footer>
      <img
        src="../assets/image/promo_code.png"
        alt="coupon code"
        width="50px"
      />
      <p>Do you have Coupon Code?</p>
      <input type="text" />
    </footer>

    <script>
      let inputDate = document.getElementById("card_exp_date");
      let today = new Date();
      today.setDate(today.getDate() + 10);
      let minDate = today.toISOString().split("T")[0];
      inputDate.setAttribute("min", minDate);

      const oneUser = JSON.parse(localStorage.getItem("logIn"));

      const user_info = JSON.parse(localStorage.getItem("user_info"));
      let select_user = user_info.find(function (event) {
        let customerEmail = event["Email"];
        if (user_info == customerEmail) {
          return true;
        } else if (oneUser == customerEmail) {
          return true;
        }
      });

      console.log(select_user);
      // to get value from registration form
      const Card_no = document.getElementById("Bank_Card_no");
      const holder_name = document.getElementById("holder_name");
      const ifsc = document.getElementById("ifsc_code");
      const cvv_no = document.getElementById("cvv_no");
      const exp_date = document.getElementById("card_exp_date");

      // Compare the values

      Card_no.value = select_user["Bank_Card_no"];
      holder_name.value = select_user["Account_holder_name"] || "";
      ifsc.value = select_user["IFSC_Code"] || "";
      cvv_no.value = select_user["CVV_No"];
      exp_date.value = select_user["Card_Expiry_Date"];

      // to replace the values
      const form = document.getElementById("form");
      form.addEventListener("submit", function (event) {
        event.preventDefault();

        let Bank_Card_no = document.getElementById("Bank_Card_no").value;
        let Account_holder_name = document.getElementById("holder_name").value;
        let IFSC_Code = document.getElementById("ifsc_code").value;
        let CVV_No = document.getElementById("cvv_no").value;
        let Card_Expiry_Date = document.getElementById("card_exp_date").value;

        let newData = {
          Bank_Card_no,
          Account_holder_name,
          IFSC_Code,
          CVV_No,
          Card_Expiry_Date,
        };
        console.log(newData);

        // assign the value to

        const combineData = Object.assign(select_user, newData);
        console.log(combineData);
        alert("successfully changed");

        let findIndex = user_info.indexOf(select_user);
        user_info[findIndex] = combineData;
        localStorage.setItem("user_info", JSON.stringify(user_info));
      });

      function bill() {
        window.location.href = "/pages/14.product-bill.html";
      }
      function profile() {
        window.location.href = "/pages/profile.html";
      }
      function back() {
        window.history.back();
      }
    </script>
  </body>
</html>
